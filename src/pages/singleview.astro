---
import SingleviewCommunity from "../components/singleview-community.astro";
import SingleviewClothes from "../components/singleview-clothes.astro";
import "../styles/singleview.css";

const { searchParams } = new URL(Astro.request.url);
const id = Number(searchParams.get("id"));

const response = await fetch(
  "https://mannrjkznhzfmztfhcxj.supabase.co/rest/v1/Marathon_apparel?select=*",
  {
    headers: {
      apikey:
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1hbm5yamt6bmh6Zm16dGZoY3hqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc2NTE3MTgsImV4cCI6MjA2MzIyNzcxOH0.OO4UXTKIzTWRysicFvCx3ERENDBZ-pBl1vuT8AY-yVg",
      Authorization:
        "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1hbm5yamt6bmh6Zm16dGZoY3hqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc2NTE3MTgsImV4cCI6MjA2MzIyNzcxOH0.OO4UXTKIzTWRysicFvCx3ERENDBZ-pBl1vuT8AY-yVg",
    },
  }
);

let products = await response.json();
console.log("Fetched products:", products);
console.log("Looking for id:", id);

let product = products.find((p: any) => Number(p.id) === id);

if (!product) {
  product = {
    name: "Produkt ikke fundet",
    image: "https://via.placeholder.com/600x800?text=Ikke+fundet",
    price: 0,
    description: "Vi kunne ikke finde dette produkt.",
  };
}
---

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Singleview</title>
  <link rel="stylesheet" href="/listeview.css" />
  <link rel="stylesheet" href="/src/styles/style.css" />
</head>
<body>
  <!-- HEADER -->
  <header class="site-header">
    <nav class="site-nav">
      <div class="nav-left">
        <img
          src="/images/menu-sort.png"
          alt="Menu"
          id="menuToggle"
          class="burger"
        />
        <img src="/images/søg-sort.png" alt="Søg" class="søg-icon" />
      </div>

      <div class="nav-logo">
        <a href="/">
          <img src="/images/logo.png" alt="Planet Nusa Logo" />
        </a>
      </div>

      <div class="nav-center">
        <a href="/marathon">Marathon Week</a>
        <a href="/listeview">Apparel</a>
        <a href="/nusabootcamp">Nusa Bootcamp</a>
        <a href="/nusaruns">Nusa Runs</a>
        <a href="/nusaswims">Nusa Swims</a>
        <a href="/nusatalks">Nusa Talks</a>
      </div>

      <div class="nav-right">
        <img src="/images/søg-sort.png" alt="Søg" class="søg-desktop" />
        <img src="/images/profil-sort.png" alt="Profil" />
        <img src="/images/kurv-sort.png" alt="Kurv" />
      </div>
    </nav>

    <div class="mobile-menu" id="mobileMenu">
      <ul>
        <li><a href="/marathon">Marathon Week</a></li>
        <li><a href="/listeview">Apparel</a></li>
        <li><a href="/nusabootcamp">Nusa Bootcamp</a></li>
        <li><a href="/nusaruns">Nusa Runs</a></li>
        <li><a href="/nusaswims">Nusa Swims</a></li>
        <li><a href="/nusatalks">Nusa Talks</a></li>
      </ul>
    </div>

    <script is:inline>
      setTimeout(() => {
        const toggle = document.getElementById("menuToggle");
        const menu = document.getElementById("mobileMenu");

        if (toggle && menu) {
          toggle.addEventListener("click", () => {
            menu.classList.toggle("open");
          });
        }
      }, 0);
    </script>
  </header>
